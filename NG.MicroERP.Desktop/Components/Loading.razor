@if (IsLoading)
{
    <div style="
        position: fixed;
        top: 0; left: 0;
        width: 100vw; height: 100vh;
        background-color: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        user-select: none;
    ">
        <div style="
            background-color: #f5f5f5;
            padding: 20px 30px;
            border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            min-width: 320px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        ">
            <!-- Circular spinner -->
            <svg width="32" height="32" viewBox="25 25 50 50" style="margin-right: 20px;">
                <circle cx="50"
                        cy="50"
                        r="20"
                        fill="none"
                        stroke="#512BD4"
                        stroke-width="4"
                        stroke-linecap="round"
                        stroke-dasharray="80 150"
                        stroke-dashoffset="0">
                    <animateTransform attributeName="transform"
                                      type="rotate"
                                      from="0 50 50"
                                      to="360 50 50"
                                      dur="1s"
                                      repeatCount="indefinite" />
                </circle>
            </svg>

            <div>
                <div style="font-weight: 600; font-size: 1.1rem; color: #212121; margin-bottom: 5px;">
                    Please Wait..
                </div>
                <div style="font-size: 0.9rem; color: #555;">
                    Loading ... @ElapsedSeconds sec
                </div>
            </div>
        </div>
    </div>
}

@code {
    private bool _isLoading;
    private int ElapsedSeconds = 0;
    private System.Timers.Timer? Timer;

    [Parameter]
    public bool IsLoading
    {
        get => _isLoading;
        set
        {
            if (_isLoading != value)
            {
                _isLoading = value;
                if (_isLoading)
                    StartTimer();
                else
                    StopTimer();

                InvokeAsync(StateHasChanged);
            }
        }
    }

    private void StartTimer()
    {
        ElapsedSeconds = 0;
        Timer = new System.Timers.Timer(1000);
        Timer.Elapsed += Timer_Elapsed;
        Timer.AutoReset = true;
        Timer.Start();
    }

    private void Timer_Elapsed(object? sender, System.Timers.ElapsedEventArgs e)
    {
        ElapsedSeconds++;
        InvokeAsync(StateHasChanged);
    }

    private void StopTimer()
    {
        if (Timer != null)
        {
            Timer.Stop();
            Timer.Elapsed -= Timer_Elapsed;
            Timer.Dispose();
            Timer = null;
        }
        ElapsedSeconds = 0;
    }
}
