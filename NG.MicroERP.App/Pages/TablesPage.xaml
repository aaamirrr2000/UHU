<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NG.MicroERP.App.Pages.TablesPage"
             BackgroundColor="White"
             NavigationPage.HasNavigationBar="False"
             Title="TablesPage">

    <ContentPage.Background>
        <LinearGradientBrush EndPoint="0,1">
            <GradientStop Color="#E6F0FA" Offset="0.0" />
            <GradientStop Color="#FFFFFF" Offset="1.0" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <ScrollView>
        <Grid Padding="10">

            <Border StrokeThickness="0"
                    Margin="5"
                    Padding="5"
                    BackgroundColor="White"
                    HorizontalOptions="Fill"
                    StrokeShape="RoundRectangle 15">

                <Border.Shadow>
                    <Shadow Brush="#20000000"
                            Offset="0,5"
                            Radius="10"
                            Opacity="0.3" />
                </Border.Shadow>

                <VerticalStackLayout Spacing="20">

                    <Label Text="Tables"
                           FontSize="28"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="#333"
                           FontFamily="Orbitron" />

                    <ActivityIndicator x:Name="LoadingIndicator"
                                       IsVisible="False"
                                       IsRunning="False"
                                       Color="#00C4B4"
                                       HeightRequest="40" />

                    <RefreshView x:Name="refreshView"
                                 IsRefreshing="False"
                                 Refreshing="OnRefresh">

                        <CollectionView x:Name="TablesPageRef"
                                        ItemsSource="{Binding Tables}"
                                        SelectionMode="Single"
                                        SelectionChanged="TablesCollectionView_SelectionChanged">

                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Vertical"
                                                   ItemSpacing="2" />
                            </CollectionView.ItemsLayout>

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Border StrokeThickness="0"
                                            Margin="10"
                                            Padding="20"
                                            BackgroundColor="#F0F1F3"
                                            HorizontalOptions="Fill"
                                            StrokeShape="RoundRectangle 15">

                                        <Grid ColumnDefinitions="*, Auto"
                                              RowDefinitions="Auto, Auto"
                                              ColumnSpacing="10"
                                              RowSpacing="10"
                                              Padding="0">

                                            <!-- Row 0: Table Name and Capacity -->
                                            <Label Grid.Row="0" Grid.Column="0"
                                                   Text="{Binding TableNumber}"
                                                   FontAttributes="Bold"
                                                   TextColor="Black"
                                                   FontSize="16"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="Start" />

                                            <Label Grid.Row="0" Grid.Column="1"
                                                   Text="{Binding Capacity, StringFormat='Capacity: {0} Persons'}"
                                                   FontSize="13"
                                                   TextColor="Gray"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="End" />

                                            <!-- Row 1: Buttons -->
                                            <HorizontalStackLayout Grid.Row="1" Grid.ColumnSpan="2"
                                                                   Spacing="10"
                                                                   HorizontalOptions="Center"
                                                                   VerticalOptions="Center">
                                                <Button Text="Dine-In"
                                                        ClassId="DineIn"
                                                        Clicked="ServiceTypeButton_Clicked"
                                                        CommandParameter="{Binding .}" />

                                                <Button Text="Takeaway"
                                                        ClassId="Takeaway"
                                                        Clicked="ServiceTypeButton_Clicked"
                                                        CommandParameter="{Binding .}" />

                                                <Button Text="Parcel"
                                                        ClassId="Parcel"
                                                        Clicked="ServiceTypeButton_Clicked"
                                                        CommandParameter="{Binding .}" />
                                            </HorizontalStackLayout>
                                        </Grid>

                                        <Border.GestureRecognizers>
                                            <TapGestureRecognizer Command="{Binding BindingContext.TableTappedCommand, Source={x:Reference TablesPageRef}}"
                                                                  CommandParameter="{Binding .}" />
                                        </Border.GestureRecognizers>

                                    </Border>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                    </RefreshView>

                </VerticalStackLayout>

            </Border>

        </Grid>
    </ScrollView>

</ContentPage>
