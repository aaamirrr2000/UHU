<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:NG.MicroERP.Shared.Models;assembly=NG.MicroERP.Shared"
        x:Class="Avalonia.Pages.Invoices.InvoicePage"
        Title="Invoice"
        Width="1200"
        Height="800"
        MinWidth="900"
        MinHeight="600"
        WindowState="Maximized"
        Background="#0c0e12">

    <Window.Styles>
        <Style Selector="Border.invoice-card">
            <Setter Property="Background" Value="#161a22" />
            <Setter Property="BorderBrush" Value="#2a3140" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="16" />
        </Style>
        <Style Selector="TextBlock.invoice-title">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#e8eaed" />
        </Style>
        <Style Selector="TextBox.invoice-input">
            <Setter Property="Background" Value="#1e232b" />
            <Setter Property="Foreground" Value="#e8eaed" />
            <Setter Property="BorderBrush" Value="#2a3140" />
        </Style>
        <Style Selector="ComboBox.invoice-combo">
            <Setter Property="Background" Value="#1e232b" />
            <Setter Property="Foreground" Value="#e8eaed" />
        </Style>
        <Style Selector="Button.btn-header">
            <Setter Property="Background" Value="#2a3140" />
            <Setter Property="Foreground" Value="#e8eaed" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>
        <Style Selector="Button.btn-header:pointerover">
            <Setter Property="Background" Value="#3a4150" />
        </Style>
        <Style Selector="Button.btn-primary">
            <Setter Property="Background" Value="#5dd0c4" />
            <Setter Property="Foreground" Value="#0c0e12" />
            <Setter Property="Padding" Value="12,8" />
            <Setter Property="CornerRadius" Value="8" />
        </Style>
        <Style Selector="Button.btn-primary:pointerover">
            <Setter Property="Background" Value="#6ee0d4" />
        </Style>
        <Style Selector="Button.btn-warning">
            <Setter Property="Background" Value="#e0a020" />
            <Setter Property="Foreground" Value="#0c0e12" />
        </Style>
        <Style Selector="DataGrid">
            <Setter Property="Background" Value="#161a22" />
            <Setter Property="Foreground" Value="#e8eaed" />
        </Style>
    </Window.Styles>

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <!-- Header bar -->
        <Border Grid.Row="0" Background="#161a22" BorderBrush="#2a3140" BorderThickness="0,0,0,1" Padding="16,12">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                    <TextBlock x:Name="HeaderTitle" Text="SALE Invoice" Classes="invoice-title" VerticalAlignment="Center" />
                    <TextBlock x:Name="HeaderSubtitle" Text="New invoice" Foreground="#8b929a" FontSize="13" VerticalAlignment="Center" />
                </StackPanel>
                <TextBlock Grid.Column="1" Text="Ctrl+L Items · Ctrl+N New · Ctrl+S Save · Ctrl+P Print · Tab/Enter" Foreground="#6b7280" FontSize="11" VerticalAlignment="Center" HorizontalAlignment="Center" />
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="BtnNew" Content="New" Classes="btn-warning" Click="OnNew" ToolTip.Tip="Ctrl+N" />
                    <Button x:Name="BtnSave" Content="Save" Classes="btn-primary" Click="OnSave" ToolTip.Tip="Ctrl+S" />
                    <Button x:Name="BtnPrint" Content="Print" Classes="btn-header" Click="OnPrint" ToolTip.Tip="Ctrl+P" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Details card - all inputs same size in one line -->
        <Border Grid.Row="1" Classes="invoice-card" Margin="16,12">
            <Grid ColumnDefinitions="100,160,130,90,80,*" RowDefinitions="Auto">
                <ComboBox x:Name="ComboInvoiceType" Grid.Column="0" Classes="invoice-combo" Margin="0,0,6,0" MinHeight="36" TabIndex="0" />
                <ComboBox x:Name="ComboParty" Grid.Column="1" Classes="invoice-combo" Margin="0,0,6,0" MinHeight="36" TabIndex="1" SelectionChanged="OnPartySelectionChanged">
                    <ComboBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:PartiesModel}">
                            <TextBlock Text="{Binding DisplayName}" Foreground="#e8eaed" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <DatePicker x:Name="DateTranDate" Grid.Column="2" Margin="0,0,6,0" MinHeight="36" TabIndex="2" />
                <TextBox x:Name="TxtInvoiceCode" Grid.Column="3" Classes="invoice-input" IsReadOnly="True" Margin="0,0,6,0" MinHeight="36" TabIndex="3" />
                <TextBox x:Name="TxtCurrency" Grid.Column="4" Classes="invoice-input" IsReadOnly="True" Margin="0,0,6,0" MinHeight="36" TabIndex="4" />
                <TextBox x:Name="TxtDescription" Grid.Column="5" Classes="invoice-input" Margin="0,0,0,0" MinHeight="36" MinWidth="100" TabIndex="5" />
            </Grid>
        </Border>

        <!-- Line items (left) + Items list (right) -->
        <Border Grid.Row="2" Classes="invoice-card" Margin="16,0">
            <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" ColumnDefinitions="*,280">
                <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Orientation="Horizontal" Spacing="8" Margin="0,0,0,6">
                    <Button x:Name="BtnItems" Content="Items (Ctrl+L)" Classes="btn-primary" Click="OnItemsClick" TabIndex="10" />
                    <Button x:Name="BtnManualLine" Content="Manual line" Classes="btn-header" Click="OnManualLine" TabIndex="11" />
                    <Button x:Name="BtnEditLine" Content="Edit line" Classes="btn-header" Click="OnEditLine" TabIndex="12" />
                    <Button x:Name="BtnUpdateGrid" Content="Update grid" Classes="btn-primary" Click="OnUpdateGrid" TabIndex="13" />
                    <Button x:Name="BtnDeleteLine" Content="Delete line" Classes="btn-header" Click="OnDeleteLine" TabIndex="14" />
                    <Button x:Name="BtnPayment" Content="Payment" Classes="btn-primary" Click="OnPayment" TabIndex="15" />
                </StackPanel>
                <!-- Left: Grid header -->
                <Border Grid.Row="1" Grid.Column="0" Background="#2a3140" CornerRadius="2" Padding="6,4" Margin="0,0,4,1">
                    <Grid ColumnDefinitions="2*,*,*,*,*,*">
                        <TextBlock Grid.Column="0" Text="Item" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1" Text="Qty" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="2" Text="Price" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="3" Text="Disc" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="4" Text="Tax" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="5" Text="Total" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" />
                    </Grid>
                </Border>
                <!-- Right: Items list header -->
                <Border Grid.Row="1" Grid.Column="1" Background="#2a3140" CornerRadius="2" Padding="6,4" Margin="0,0,0,1">
                    <TextBlock Text="Items — click to add" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" />
                </Border>
                <!-- Left: Grid lines -->
                <ListBox x:Name="GridLines"
                         Grid.Row="2"
                         Grid.Column="0"
                         Background="#161a22"
                         BorderThickness="0,0,1,0"
                         BorderBrush="#2a3140"
                         TabIndex="16"
                         SelectionMode="Single"
                         DoubleTapped="OnLineDoubleTapped"
                         Margin="0,0,4,0">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:InvoiceItemReportModel}">
                            <Border Background="#1e232b" BorderBrush="#2a3140" BorderThickness="0,0,0,1" Padding="6,3" Margin="0,0,0,0">
                                <Grid ColumnDefinitions="2*,*,*,*,*,*">
                                    <TextBlock Grid.Column="0" Text="{Binding ItemName}" Foreground="#e8eaed" FontSize="12" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" />
                                    <TextBlock Grid.Column="1" Text="{Binding Qty, StringFormat=N2}" Foreground="#e8eaed" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                                    <TextBlock Grid.Column="2" Text="{Binding UnitPrice, StringFormat=N2}" Foreground="#e8eaed" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                                    <TextBlock Grid.Column="3" Text="{Binding DiscountAmount, StringFormat=N2}" Foreground="#8b929a" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                                    <TextBlock Grid.Column="4" Text="{Binding TaxAmount, StringFormat=N2}" Foreground="#8b929a" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                                    <TextBlock Grid.Column="5" Text="{Binding ItemTotalAmount, StringFormat=N2}" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <!-- Right: Items list -->
                <Border Grid.Row="2" Grid.Column="1" Background="#161a22" BorderThickness="0,0,0,0" Padding="0,4,0,0">
                    <Grid RowDefinitions="Auto,*">
                        <TextBox Grid.Row="0" x:Name="TxtItemSearch" Watermark="Search items..." Background="#1e232b" Foreground="#e8eaed" Margin="0,0,0,4" FontSize="12" TextChanged="OnItemSearchChanged" />
                        <ListBox x:Name="ItemsList"
                                 Grid.Row="1"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Focusable="True"
                                 SelectionMode="Single"
                                 SelectionChanged="OnItemFromListSelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="{x:Type models:ItemsModel}">
                                    <Border Background="#1e232b" CornerRadius="4" Padding="6,4" Margin="0,0,0,2">
                                        <StackPanel Spacing="2">
                                            <TextBlock Text="{Binding Name}" Foreground="#e8eaed" FontSize="12" TextTrimming="CharacterEllipsis" />
                                            <TextBlock Text="{Binding BasePrice, StringFormat=N2}" Foreground="#5dd0c4" FontSize="11" />
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
                <!-- Left: Column totals row -->
                <Border Grid.Row="3" Grid.Column="0" Background="#2a3140" CornerRadius="2" Padding="6,4" Margin="0,1,4,0">
                    <Grid ColumnDefinitions="2*,*,*,*,*,*">
                        <TextBlock Grid.Column="0" Text="Total" Foreground="#e8eaed" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" />
                        <TextBlock Grid.Column="1" x:Name="TxtTotalQty" Text="0" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="2" Text="" Foreground="#e8eaed" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="3" x:Name="TxtTotalDiscount" Text="0.00" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="4" x:Name="TxtTotalTax" Text="0.00" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" Margin="2,0" />
                        <TextBlock Grid.Column="5" x:Name="TxtTotalLineAmount" Text="0.00" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="12" VerticalAlignment="Center" />
                    </Grid>
                </Border>
                <Border Grid.Row="4" Grid.Column="0" Background="#1e232b" CornerRadius="8" Padding="12" Margin="0,6,4,0">
                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*,Auto">
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal" Foreground="#8b929a" VerticalAlignment="Center" />
                        <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TxtSubtotal" Foreground="#e8eaed" FontWeight="SemiBold" HorizontalAlignment="Right" Margin="0,0,24,4" />
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Discount" Foreground="#8b929a" VerticalAlignment="Center" Margin="0,4,0,0" />
                        <TextBox Grid.Row="1" Grid.Column="1" x:Name="TxtInvoiceDiscount" Classes="invoice-input" Width="120" HorizontalAlignment="Right" Margin="0,4,24,4" TextChanged="OnInvoiceDiscountChanged" />
                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Service charges" Foreground="#8b929a" VerticalAlignment="Center" Margin="0,4,0,0" />
                        <TextBox Grid.Row="2" Grid.Column="1" x:Name="TxtServiceCharges" Classes="invoice-input" Width="120" HorizontalAlignment="Right" Margin="0,4,24,4" TextChanged="OnServiceChargesChanged" />
                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Tax" Foreground="#8b929a" VerticalAlignment="Center" Margin="0,4,0,0" />
                        <TextBox Grid.Row="3" Grid.Column="1" x:Name="TxtInvoiceTax" Classes="invoice-input" Width="120" HorizontalAlignment="Right" Margin="0,4,24,4" TextChanged="OnInvoiceTaxChanged" />
                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Invoice total" Foreground="#5dd0c4" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,4,0,0" />
                        <TextBlock Grid.Row="4" Grid.Column="1" x:Name="TxtInvoiceTotal" Foreground="#5dd0c4" FontWeight="SemiBold" FontSize="16" HorizontalAlignment="Right" Margin="0,4,24,0" />
                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Total paid" Foreground="#8b929a" VerticalAlignment="Center" Margin="0,4,0,0" />
                        <TextBlock Grid.Row="5" Grid.Column="1" x:Name="TxtTotalPaid" Foreground="#e8eaed" FontWeight="SemiBold" HorizontalAlignment="Right" Margin="0,4,24,0" />
                        <TextBlock Grid.Row="6" Grid.Column="0" Text="Balance" Foreground="#e0a020" FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,8,0,0" />
                        <TextBlock Grid.Row="6" Grid.Column="1" x:Name="TxtBalance" Foreground="#e0a020" FontWeight="SemiBold" FontSize="14" HorizontalAlignment="Right" Margin="0,8,24,0" />
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Status / messages -->
        <TextBlock x:Name="StatusText" Grid.Row="3" Foreground="#8b929a" FontSize="12" Margin="16,8" />

        <!-- Busy overlay -->
        <Border x:Name="BusyOverlay" Grid.Row="0" Grid.RowSpan="4" Background="#CC0c0e12" IsVisible="False" ZIndex="100">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#5dd0c4" />
                <TextBlock Text="Loading…" Foreground="#e8eaed" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
