@page "/UserProfilePage"
@inject NavigationManager Nav

<PageTitle>My Profile</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudCard>
        <MudCardContent>
            <MudText Typo="Typo.h5" Class="mb-4">User Profile</MudText>

            @if (MyGlobals.User != null)
            {
                <MudGrid>
                    <!-- Profile Picture -->
                    <MudItem xs="12" Class="text-center mb-4">
                        @if (!string.IsNullOrEmpty(MyGlobals.User.Pic))
                        {
                            <img src="@MyGlobals.User.Pic" alt="Profile" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--mud-palette-primary);" />
                        }
                        else
                        {
                            <div style="width: 120px; height: 120px; border-radius: 50%; background-color: var(--mud-palette-primary); display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 48px; margin: 0 auto;">
                                <i class="fas fa-user"></i>
                            </div>
                        }
                    </MudItem>

                    <!-- User Information -->
                    <MudItem xs="12" md="6">
                        <MudTextField Label="Full Name" Variant="Variant.Outlined" Value="@MyGlobals.User.FullName" ReadOnly="true" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField Label="Username" Variant="Variant.Outlined" Value="@MyGlobals.User.Username" ReadOnly="true" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField Label="User Type" Variant="Variant.Outlined" Value="@MyGlobals.User.UserType" ReadOnly="true" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField Label="Group" Variant="Variant.Outlined" Value="@MyGlobals.User.GroupName" ReadOnly="true" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField Label="Email" Variant="Variant.Outlined" Value="@MyGlobals.User.Email" ReadOnly="true" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField Label="Location" Variant="Variant.Outlined" Value="@MyGlobals.User.LocationName" ReadOnly="true" />
                    </MudItem>

                    <!-- Employee Information -->
                    @if (MyGlobals.User.SelectedEmployee != null)
                    {
                        <MudItem xs="12">
                            <MudDivider Class="my-4" />
                            <MudText Typo="Typo.h6" Class="mb-3">Employee Information</MudText>
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Employee ID" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.EmpId" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Full Name" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.Fullname" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Department" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.DepartmentName" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Designation" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.DesignationName" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Phone" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.Phone" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12" md="6">
                            <MudTextField Label="Employee Email" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.Email" ReadOnly="true" />
                        </MudItem>

                        <MudItem xs="12">
                            <MudTextField Label="Address" Variant="Variant.Outlined" Value="@MyGlobals.User.SelectedEmployee.Address" ReadOnly="true" Lines="2" />
                        </MudItem>
                    }
                    else if (MyGlobals.User.EmpId > 0)
                    {
                        <MudItem xs="12">
                            <MudAlert Severity="Severity.Info">Employee ID: @MyGlobals.User.EmpId - Employee details not loaded</MudAlert>
                        </MudItem>
                    }

                    <!-- Actions -->
                    <MudItem xs="12" Class="mt-4">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="GoBack">Back</MudButton>
                    </MudItem>
                </MudGrid>
            }
            else
            {
                <MudAlert Severity="Severity.Warning">No user information available. Please log in again.</MudAlert>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-3" OnClick="GoToLogin">Go to Login</MudButton>
            }
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        MyGlobals.PageTitle = "My Profile";
    }

    private void GoBack()
    {
        Nav.NavigateTo("/");
    }

    private void GoToLogin()
    {
        Nav.NavigateTo("/", true);
    }
}
