<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MicroERP.App.SwiftServe.Components.MauiPages.Controls"
             x:Class="MicroERP.App.SwiftServe.Components.MauiPages.OrderDetailsPage"
             Title="Order Details"
             BackgroundColor="#F5F5F5">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#512BD4</Color>
            <Color x:Key="WhiteColor">#FFFFFF</Color>
            <Color x:Key="TextPrimary">#212121</Color>
            <Color x:Key="TextSecondary">#666666</Color>
            <Color x:Key="SuccessColor">#28a745</Color>
            <Color x:Key="DangerColor">#dc3545</Color>
            <Color x:Key="WarningColor">#ffc107</Color>
            <Color x:Key="InfoColor">#17a2b8</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="*">
        <controls:NavigationMenu x:Name="NavMenu" Grid.Row="0" Grid.RowSpan="2" ZIndex="1000"/>
        <ScrollView Grid.Row="0">
        <StackLayout Spacing="12" Padding="8">
            <Frame BackgroundColor="{StaticResource PrimaryColor}"
                   CornerRadius="12"
                   Padding="60,16,20,16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <StackLayout Spacing="8">
                    <Button Text="â† Back"
                            Clicked="OnBackClicked"
                            BackgroundColor="#E0FFFFFF"
                            TextColor="{StaticResource PrimaryColor}"
                            FontSize="14"
                            Padding="15,8"
                            CornerRadius="8"
                            HorizontalOptions="Start"
                            Margin="0,0,0,8"/>
                    <Label x:Name="HeaderTitle"
                           Text="Order Summary"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource WhiteColor}"/>
                </StackLayout>
            </Frame>

            <!-- Order header -->
            <Frame BackgroundColor="{StaticResource WhiteColor}"
                   BorderColor="#E0E0E0"
                   CornerRadius="12"
                   Padding="16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <StackLayout Spacing="8">
                    <Label x:Name="OrderCodeLabel" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextPrimary}"/>
                    <Label x:Name="OrderMetaLabel" FontSize="14" TextColor="{StaticResource TextSecondary}"/>
                </StackLayout>
            </Frame>

            <!-- Line items with live status -->
            <Frame BackgroundColor="{StaticResource WhiteColor}"
                   BorderColor="#E0E0E0"
                   CornerRadius="12"
                   Padding="16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <StackLayout Spacing="8">
                    <Label Text="Items" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource TextPrimary}"/>
                    <CollectionView x:Name="DetailsCollectionView" ItemsSource="{Binding InvoiceDetails}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#FAFAFA" BorderColor="#EEEEEE" CornerRadius="8" Padding="12" Margin="0,0,0,6" HasShadow="False">
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                        <StackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding Item}" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource TextPrimary}"/>
                                            <Label Text="{Binding Qty, StringFormat='Qty: {0}'}" FontSize="13" TextColor="{StaticResource TextSecondary}"/>
                                            <Label Text="{Binding UnitPrice, StringFormat='Price: {0:F2}'}" FontSize="13" TextColor="{StaticResource TextSecondary}"/>
                                        </StackLayout>
                                        <Border Grid.Column="1" Padding="10,6" VerticalOptions="Center" BackgroundColor="{StaticResource InfoColor}" StrokeThickness="0">
                                            <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
                                            <Border.Triggers>
                                                <DataTrigger TargetType="Border" Binding="{Binding InvoiceDetailStatus}" Value="COMPLETE">
                                                    <Setter Property="BackgroundColor" Value="{StaticResource SuccessColor}"/>
                                                </DataTrigger>
                                                <DataTrigger TargetType="Border" Binding="{Binding InvoiceDetailStatus}" Value="IN_PROGRESS">
                                                    <Setter Property="BackgroundColor" Value="{StaticResource WarningColor}"/>
                                                </DataTrigger>
                                            </Border.Triggers>
                                            <Label Text="{Binding InvoiceDetailStatus}" FontSize="12" FontAttributes="Bold" TextColor="{StaticResource WhiteColor}"/>
                                        </Border>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- Final bill / Pay -->
            <Button Text="Final bill / Pay" Clicked="OnFinalBillClicked"
                    BackgroundColor="{StaticResource SuccessColor}" TextColor="{StaticResource WhiteColor}"
                    CornerRadius="10" Padding="14" FontSize="16" FontAttributes="Bold" Margin="0,8,0,0"/>

        </StackLayout>
    </ScrollView>
        <controls:LoadingOverlay x:Name="LoadingOverlay" Grid.Row="0" IsVisible="False" Message="Loading..."/>
    </Grid>
</ContentPage>

