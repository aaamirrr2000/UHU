<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:MicroERP.App.SwiftServe.Components.MauiPages.Converters"
             x:Class="MicroERP.App.SwiftServe.Components.MauiPages.OrdersPage"
             Title="Orders"
             BackgroundColor="#F5F5F5">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#512BD4</Color>
            <Color x:Key="WhiteColor">#FFFFFF</Color>
            <Color x:Key="TextPrimary">#212121</Color>
            <Color x:Key="TextSecondary">#666666</Color>
            <Color x:Key="SuccessColor">#28a745</Color>
            <Color x:Key="DangerColor">#dc3545</Color>
            <Color x:Key="WarningColor">#ffc107</Color>
            <Color x:Key="InfoColor">#17a2b8</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="8">
            
            <!-- Header -->
            <Frame BackgroundColor="{StaticResource PrimaryColor}"
                   CornerRadius="12"
                   Padding="20,16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <StackLayout Spacing="8">
                    <Label x:Name="HeaderTitle"
                           Text="Orders History"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource WhiteColor}"/>
                    <Label Text="View and manage all orders"
                           FontSize="14"
                           TextColor="#E0FFFFFF"/>
                </StackLayout>
            </Frame>

            <!-- Filters -->
            <Frame BackgroundColor="{StaticResource WhiteColor}"
                   BorderColor="#E0E0E0"
                   CornerRadius="12"
                   Padding="16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="8" RowDefinitions="Auto,Auto" RowSpacing="8">
                    <!-- Date Input -->
                    <Label Text="Date"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextSecondary}"
                           Grid.Row="0" Grid.Column="0"/>
                    <DatePicker x:Name="DatePicker"
                                DateSelected="OnDateChanged"
                                Date="{Binding FromDate}"
                                Format="yyyy-MM-dd"
                                Grid.Row="1" Grid.Column="0"/>
                    
                    <!-- Search Input -->
                    <Label Text="Search"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextSecondary}"
                           Grid.Row="0" Grid.Column="1"/>
                    <Entry x:Name="SearchEntry"
                           Placeholder="Search"
                           TextChanged="OnSearchTextChanged"
                           TextColor="{StaticResource TextPrimary}"
                           Grid.Row="1" Grid.Column="1"/>
                    
                    <!-- Refresh Button -->
                    <Button Text="ðŸ”"
                            Clicked="OnRefreshClicked"
                            BackgroundColor="{StaticResource PrimaryColor}"
                            TextColor="{StaticResource WhiteColor}"
                            CornerRadius="8"
                            WidthRequest="50"
                            HeightRequest="50"
                            FontSize="20"
                            Grid.Row="0" Grid.Column="2" Grid.RowSpan="2"
                            VerticalOptions="End"/>
                </Grid>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator x:Name="LoadingIndicator"
                              IsRunning="True"
                              IsVisible="False"
                              Color="{StaticResource PrimaryColor}"
                              HeightRequest="40"
                              WidthRequest="40"
                              HorizontalOptions="Center"
                              Margin="0,20"/>

            <!-- Orders Collection -->
            <CollectionView x:Name="OrdersCollectionView"
                           ItemsSource="{Binding FilteredInvoices}"
                           SelectionMode="None"
                           Margin="0,0,0,20">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="{StaticResource WhiteColor}"
                               BorderColor="#E0E0E0"
                               CornerRadius="12"
                               Padding="16"
                               HasShadow="True"
                               Margin="0,0,0,16">
                            <StackLayout Spacing="12">
                                <!-- Order Info -->
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                    <StackLayout Grid.Column="0" Spacing="4">
                                        <Label Text="{Binding Code, StringFormat='Bill: {0}'}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource TextPrimary}"/>
                                        <Label Text="{Binding TableName, StringFormat='Table: {0}'}"
                                               FontSize="14"
                                               TextColor="{StaticResource TextSecondary}"/>
                                        <Label Text="{Binding ServiceType, StringFormat='Service: {0}'}"
                                               FontSize="14"
                                               TextColor="{StaticResource TextSecondary}"/>
                                        <Label Text="{Binding PartyName, StringFormat='Customer: {0}'}"
                                               FontSize="14"
                                               TextColor="{StaticResource TextSecondary}"
                                               IsVisible="{Binding PartyName, Converter={StaticResource IsNotEmptyConverter}}"/>
                                    </StackLayout>
                                    
                                    <!-- Status Badge -->
                                    <Frame x:Name="StatusBadge"
                                           BackgroundColor="{StaticResource SuccessColor}"
                                           CornerRadius="8"
                                           Padding="12,6"
                                           HasShadow="False"
                                           Grid.Column="1">
                                        <Label x:Name="StatusLabel"
                                               Text="{Binding Status}"
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource WhiteColor}"/>
                                    </Frame>
                                </Grid>
                                
                                <!-- Waiting Time (if not complete) -->
                                <Label x:Name="WaitingTimeLabel"
                                       Text="{Binding ElapsedTime, StringFormat='Waiting Time: {0}'}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{StaticResource DangerColor}"
                                       IsVisible="False"/>
                                
                                <!-- Action Buttons -->
                                <StackLayout Orientation="Horizontal" Spacing="8">
                                    <Button Text="View"
                                            Clicked="OnViewClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource InfoColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            CornerRadius="8"
                                            Padding="12,8"
                                            FontSize="14"/>
                                    
                                    <!-- Waiter Actions -->
                                    <Button x:Name="DeleteButton"
                                            Text="Delete"
                                            Clicked="OnDeleteClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource DangerColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            CornerRadius="8"
                                            Padding="12,8"
                                            FontSize="14"
                                            IsVisible="False"/>
                                    
                                    <Button x:Name="GenerateBillButton"
                                            Text="Gen. Bill"
                                            Clicked="OnGenerateBillClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource SuccessColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            CornerRadius="8"
                                            Padding="12,8"
                                            FontSize="14"
                                            IsVisible="False"/>
                                    
                                    <Button x:Name="NotesButton"
                                            Text="Notes"
                                            Clicked="OnNotesClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource PrimaryColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            CornerRadius="8"
                                            Padding="12,8"
                                            FontSize="14"
                                            IsVisible="False"/>
                                    
                                    <!-- Kitchen Actions -->
                                    <Button x:Name="ReadyButton"
                                            Text="Ready"
                                            Clicked="OnReadyClicked"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource InfoColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            CornerRadius="8"
                                            Padding="12,8"
                                            FontSize="14"
                                            IsVisible="False"/>
                                </StackLayout>
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Empty State -->
            <StackLayout x:Name="EmptyStateLayout"
                        IsVisible="False"
                        Spacing="20"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Margin="0,40">
                <Label Text="ðŸ“‹"
                       FontSize="80"
                       HorizontalOptions="Center"
                       Opacity="0.3"/>
                <Label Text="No bills found"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextSecondary}"
                       HorizontalOptions="Center"/>
            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>

