<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MicroERP.App.SwiftServe.Components.MauiPages.OrderPage"
             Title="Menu Items"
             BackgroundColor="#F5F5F5">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#512BD4</Color>
            <Color x:Key="WhiteColor">#FFFFFF</Color>
            <Color x:Key="TextPrimary">#212121</Color>
            <Color x:Key="TextSecondary">#666666</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Spacing="0" Padding="8">
            
            <!-- Header -->
            <Frame BackgroundColor="{StaticResource PrimaryColor}"
                   CornerRadius="12"
                   Padding="20,16"
                   Margin="0,0,0,12"
                   HasShadow="True">
                <StackLayout Spacing="8">
                    <Label Text="Menu Items"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource WhiteColor}"/>
                    <Label x:Name="HeaderSubtitle"
                           Text="Service: Dine-In"
                           FontSize="14"
                           TextColor="#E0FFFFFF"/>
                    <StackLayout Orientation="Horizontal" Spacing="8" HorizontalOptions="End" Margin="0,8,0,0">
                        <Button Text="ðŸ›’ Cart"
                                Clicked="OnViewCartClicked"
                                BackgroundColor="#E0FFFFFF"
                                TextColor="{StaticResource PrimaryColor}"
                                FontSize="14"
                                Padding="15,8"
                                CornerRadius="8"/>
                        <Button Text="Back"
                                Clicked="OnBackClicked"
                                BackgroundColor="#E0FFFFFF"
                                TextColor="{StaticResource PrimaryColor}"
                                FontSize="14"
                                Padding="15,8"
                                CornerRadius="8"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- Category Buttons -->
            <ScrollView Orientation="Horizontal" Margin="0,0,0,12">
                <StackLayout Orientation="Horizontal" Spacing="8" x:Name="CategoryButtonsLayout"/>
            </ScrollView>

            <!-- Loading Indicator -->
            <ActivityIndicator x:Name="LoadingIndicator"
                              IsRunning="True"
                              IsVisible="False"
                              Color="{StaticResource PrimaryColor}"
                              HeightRequest="40"
                              WidthRequest="40"
                              HorizontalOptions="Center"
                              Margin="0,20"/>

            <!-- Menu Items Collection -->
            <CollectionView x:Name="MenuItemsCollectionView"
                           ItemsSource="{Binding MenuItems}"
                           SelectionMode="None"
                           Margin="0,0,0,20">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                   Span="2"
                                   HorizontalItemSpacing="8"
                                   VerticalItemSpacing="8"/>
                </CollectionView.ItemsLayout>
                
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="{StaticResource WhiteColor}"
                               BorderColor="#E0E0E0"
                               CornerRadius="12"
                               Padding="16"
                               HasShadow="True"
                               Margin="4">
                            <StackLayout Spacing="12">
                                <!-- Item Name and Price -->
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                    <Label Text="{Binding Name}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"
                                           Grid.Column="0"
                                           LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding RetailPrice, StringFormat='{0:N2}'}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource PrimaryColor}"
                                           Grid.Column="1"/>
                                </Grid>
                                
                                <!-- Quantity Selector -->
                                <StackLayout Orientation="Horizontal" Spacing="8" HorizontalOptions="Center">
                                    <Button Text="-"
                                            Clicked="OnDecreaseQty"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource PrimaryColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            CornerRadius="20"
                                            FontSize="18"
                                            FontAttributes="Bold"/>
                                    <Label Text="{Binding MaxQty}"
                                           FontSize="18"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextPrimary}"
                                           WidthRequest="60"
                                           HorizontalTextAlignment="Center"
                                           VerticalOptions="Center"/>
                                    <Button Text="+"
                                            Clicked="OnIncreaseQty"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource PrimaryColor}"
                                            TextColor="{StaticResource WhiteColor}"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            CornerRadius="20"
                                            FontSize="18"
                                            FontAttributes="Bold"/>
                                </StackLayout>
                                
                                <!-- Serving Size (if available) -->
                                <StackLayout x:Name="ServingSizeLayout" Spacing="8" IsVisible="False">
                                    <Label Text="Serving Size:"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <ScrollView Orientation="Horizontal">
                                        <StackLayout Orientation="Horizontal" Spacing="8" x:Name="ServingSizeButtons"/>
                                    </ScrollView>
                                </StackLayout>
                                
                                <!-- Person/Chair Selector (if table has capacity) -->
                                <StackLayout x:Name="PersonLayout" Spacing="8" IsVisible="False">
                                    <Label Text="Person:"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           TextColor="{StaticResource TextSecondary}"/>
                                    <ScrollView Orientation="Horizontal">
                                        <StackLayout Orientation="Horizontal" Spacing="8" x:Name="PersonButtons"/>
                                    </ScrollView>
                                </StackLayout>
                                
                                <!-- Add to Cart Button -->
                                <Button Text="Add to Cart"
                                        Clicked="OnAddToCart"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="{StaticResource PrimaryColor}"
                                        TextColor="{StaticResource WhiteColor}"
                                        CornerRadius="8"
                                        HeightRequest="44"
                                        FontSize="16"
                                        FontAttributes="Bold"
                                        Margin="0,8,0,0"/>
                                
                                <!-- View Cart Button (optional - can be added to header) -->
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Empty State -->
            <StackLayout x:Name="EmptyStateLayout"
                        IsVisible="False"
                        Spacing="20"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        Margin="0,40">
                <Label Text="ðŸ½"
                       FontSize="80"
                       HorizontalOptions="Center"
                       Opacity="0.3"/>
                <Label Text="No items found"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="{StaticResource TextSecondary}"
                       HorizontalOptions="Center"/>
                <Label Text="No menu items available in this category."
                       FontSize="14"
                       TextColor="{StaticResource TextSecondary}"
                       HorizontalOptions="Center"
                       HorizontalTextAlignment="Center"/>
            </StackLayout>

        </StackLayout>
    </ScrollView>
</ContentPage>

