<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MicroERP.App.SwiftServe.Components.MauiPages.Controls"
             x:Class="MicroERP.App.SwiftServe.Components.MauiPages.OrderPage"
             Title="Menu Items"
             BackgroundColor="#F0F0F0">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="PrimaryColor">#512BD4</Color>
            <Color x:Key="WhiteColor">#FFFFFF</Color>
            <Color x:Key="TextPrimary">#212121</Color>
            <Color x:Key="TextSecondary">#666666</Color>
            <Color x:Key="BorderColor">#E0E0E0</Color>
            <Color x:Key="DangerColor">#dc3545</Color>
            <Color x:Key="GreenAccent">#2E7D32</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,Auto,*">
        <controls:NavigationMenu x:Name="NavMenu" Grid.Row="0" Grid.RowSpan="4" ZIndex="1000"/>

        <!-- Toast -->
        <Border x:Name="ToastBorder" Grid.Row="0" IsVisible="False" StrokeThickness="0"
                BackgroundColor="#E02E7D32" Padding="16,12" Margin="16,8,16,4">
            <Border.StrokeShape><RoundRectangle CornerRadius="8"/></Border.StrokeShape>
            <Label x:Name="ToastLabel" Text="âœ“ Added to cart" TextColor="{StaticResource WhiteColor}" FontSize="14"/>
        </Border>

        <!-- Header: Back | Menu Items | Cart (same as Cart page) -->
        <StackLayout Grid.Row="1" Spacing="4" Margin="16,8,16,12">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                <Button Text="&lt;" Clicked="OnBackClicked" BackgroundColor="Transparent" TextColor="{StaticResource TextPrimary}"
                        FontSize="24" WidthRequest="44" HeightRequest="44" VerticalOptions="Center" Grid.Column="0"/>
                <Label Text="Menu Items" FontSize="22" FontAttributes="Bold" TextColor="{StaticResource TextPrimary}"
                       HorizontalOptions="Center" VerticalOptions="Center" Grid.Column="1"/>
                <Button Text="ðŸ›’" Clicked="OnViewCartClicked" BackgroundColor="Transparent" TextColor="{StaticResource TextPrimary}"
                        FontSize="22" WidthRequest="44" HeightRequest="44" VerticalOptions="Center" Grid.Column="2"/>
            </Grid>
            <Label x:Name="HeaderSubtitle" Text="Service: Dine-In" FontSize="13" TextColor="{StaticResource TextSecondary}"/>
        </StackLayout>

        <!-- Category filter -->
        <ScrollView Grid.Row="2" Orientation="Horizontal" Margin="16,0,16,8">
            <StackLayout Orientation="Horizontal" Spacing="8" x:Name="CategoryButtonsLayout"/>
        </ScrollView>

        <!-- Menu items: white cards like Cart (circle + name, price, green pill, Add to Cart) -->
        <ScrollView Grid.Row="3">
            <StackLayout Padding="16" Margin="0,0,0,24" Spacing="0">
                <CollectionView x:Name="MenuItemsCollectionView"
                               ItemsSource="{Binding MenuItems}"
                               SelectionMode="None">
                    <CollectionView.ItemsLayout>
                        <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BackgroundColor="{StaticResource WhiteColor}"
                                   BorderColor="{StaticResource BorderColor}"
                                   CornerRadius="12"
                                   Padding="14"
                                   HasShadow="True"
                                   Margin="0,0,0,12">
                                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="14">
                                    <Ellipse WidthRequest="64" HeightRequest="64" Fill="#F5F5F5" Grid.Column="0" VerticalOptions="Center"/>
                                    <Label Text="ðŸ½" FontSize="28" HorizontalOptions="Center" VerticalOptions="Center" Grid.Column="0"/>
                                    <StackLayout Grid.Column="1" VerticalOptions="Center" Spacing="6">
                                        <Label Text="{Binding Name}" FontSize="16" FontAttributes="Bold"
                                               TextColor="{StaticResource TextPrimary}" LineBreakMode="TailTruncation"/>
                                        <Label Text="{Binding RetailPrice, StringFormat='${0:N2}'}" FontSize="14"
                                               TextColor="{StaticResource TextSecondary}"/>
                                        <Border HeightRequest="36" BackgroundColor="{StaticResource GreenAccent}" StrokeThickness="0"
                                                VerticalOptions="Start" HorizontalOptions="Start" Margin="0,4,0,0">
                                            <Border.StrokeShape><RoundRectangle CornerRadius="18"/></Border.StrokeShape>
                                            <Grid ColumnDefinitions="Auto,*,Auto" WidthRequest="110" ColumnSpacing="0">
                                                <Button Text="âˆ’" Clicked="OnDecreaseQty" CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent" TextColor="{StaticResource WhiteColor}"
                                                        WidthRequest="36" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" Grid.Column="0"/>
                                                <Label Text="{Binding MaxQty}" FontSize="16" FontAttributes="Bold" TextColor="{StaticResource WhiteColor}"
                                                       HorizontalTextAlignment="Center" VerticalOptions="Center" Grid.Column="1"/>
                                                <Button Text="+" Clicked="OnIncreaseQty" CommandParameter="{Binding .}"
                                                        BackgroundColor="Transparent" TextColor="{StaticResource WhiteColor}"
                                                        WidthRequest="36" FontSize="18" FontAttributes="Bold" VerticalOptions="Center" Grid.Column="2"/>
                                            </Grid>
                                        </Border>
                                        <Button Text="ðŸ›’  Add to Cart" Clicked="OnAddToCart" CommandParameter="{Binding .}"
                                                BackgroundColor="{StaticResource GreenAccent}" TextColor="{StaticResource WhiteColor}"
                                                CornerRadius="10" HeightRequest="44" FontSize="15" FontAttributes="Bold" Margin="0,8,0,0"/>
                                    </StackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <StackLayout x:Name="EmptyStateLayout" IsVisible="False" Spacing="16"
                             HorizontalOptions="Center" VerticalOptions="Center" Margin="0,40">
                    <Label Text="ðŸ½" FontSize="72" HorizontalOptions="Center" Opacity="0.4"/>
                    <Label Text="No items found" FontSize="20" FontAttributes="Bold" TextColor="{StaticResource TextSecondary}" HorizontalOptions="Center"/>
                    <Label Text="No menu items in this category." FontSize="14" TextColor="{StaticResource TextSecondary}"
                           HorizontalOptions="Center" HorizontalTextAlignment="Center"/>
                </StackLayout>
            </StackLayout>
        </ScrollView>

        <controls:LoadingOverlay x:Name="LoadingOverlay" Grid.Row="0" Grid.RowSpan="4" IsVisible="False" Message="Loading menu..."/>
    </Grid>
</ContentPage>

