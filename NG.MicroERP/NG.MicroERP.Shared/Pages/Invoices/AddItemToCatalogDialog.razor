@using NG.MicroERP.Shared.Models
@using MudBlazor

<MudDialog>
    <DialogContent>
        <MudContainer MaxWidth="MaxWidth.Medium" Class="pa-4">
            <MudGrid Spacing="3" GutterSize="GutterSize.Small">
                <MudItem xs="12">
                    <MudText Typo="Typo.h6" Class="fw-bold mb-3">Add Item to Catalog</MudText>
                    <MudDivider Class="mb-3" />
                </MudItem>

                <MudItem xs="12">
                    <MudTextField @bind-Value="NewItem.Name"
                                  Label="Item Name"
                                  Variant="Variant.Outlined"
                                  FullWidth="true"
                                  Required="true"
                                  RequiredError="Item name is required"
                                  Margin="Margin.Normal"
                                  Class="new-item-field" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudSelect T="int"
                               @bind-Value="NewItem.CategoryId"
                               Label="Category"
                               Variant="Variant.Outlined"
                               FullWidth="true"
                               Required="true"
                               RequiredError="Category is required"
                               Margin="Margin.Normal"
                               Class="new-item-field">
                        @if (Categories != null && Categories.Any())
                        {
                            @foreach (var category in Categories)
                            {
                                <MudSelectItem T="int" Value="@category.Id">@category.Name</MudSelectItem>
                            }
                        }
                        else
                        {
                            <MudSelectItem T="int" Value="0" Disabled="true">No categories available</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudSelect T="string"
                               @bind-Value="NewItem.StockType"
                               Label="Stock Type"
                               Variant="Variant.Outlined"
                               FullWidth="true"
                               Margin="Margin.Normal"
                               Class="new-item-field">
                        <MudSelectItem T="string" Value=@("ITEM")>Item</MudSelectItem>
                        <MudSelectItem T="string" Value=@("SERVICE")>Service</MudSelectItem>
                        <MudSelectItem T="string" Value=@("FIXED ASSET")>Fixed Asset</MudSelectItem>
                    </MudSelect>
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudNumericField T="double"
                                    @bind-Value="NewItem.BasePrice"
                                    Label="Base Price"
                                    Variant="Variant.Outlined"
                                    FullWidth="true"
                                    Margin="Margin.Normal"
                                    Format="#,##0.00"
                                    Min="0"
                                    Class="new-item-field" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudNumericField T="double"
                                    @bind-Value="NewItem.CostPrice"
                                    Label="Cost Price"
                                    Variant="Variant.Outlined"
                                    FullWidth="true"
                                    Margin="Margin.Normal"
                                    Format="#,##0.00"
                                    Min="0"
                                    Class="new-item-field" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="NewItem.Description"
                                  Label="Description"
                                  Variant="Variant.Outlined"
                                  FullWidth="true"
                                  Margin="Margin.Normal"
                                  Lines="2"
                                  Class="new-item-field" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="NewItem.Unit"
                                  Label="Unit of Measure"
                                  Variant="Variant.Outlined"
                                  FullWidth="true"
                                  Margin="Margin.Normal"
                                  Class="new-item-field" />
                </MudItem>
            </MudGrid>
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Variant="Variant.Text" Color="Color.Default">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Save">Save Item</MudButton>
    </DialogActions>
</MudDialog>

<style>
    .new-item-field {
        margin-bottom: 8px;
    }

    :deep(.mud-dialog-actions) {
        padding: 16px 24px;
        border-top: 1px solid rgba(0, 0, 0, 0.12);
        gap: 12px;
    }
</style>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public string ItemName { get; set; } = string.Empty;
    [Parameter] public double UnitPrice { get; set; } = 0;
    [Parameter] public List<CategoriesModel> Categories { get; set; } = new();
    [Parameter] public int OrganizationId { get; set; }
    [Parameter] public int CreatedBy { get; set; }
    [Parameter] public string CreatedFrom { get; set; } = string.Empty;

    public ItemsModel NewItem { get; set; } = new ItemsModel();

    protected override void OnInitialized()
    {
        NewItem.Name = ItemName;
        NewItem.BasePrice = UnitPrice;
        NewItem.CostPrice = UnitPrice;
        NewItem.OrganizationId = OrganizationId;
        NewItem.CreatedBy = CreatedBy;
        NewItem.CreatedFrom = CreatedFrom;
        NewItem.IsActive = 1;
        NewItem.StockType = "ITEM";
    }

    private void Cancel() => MudDialog.Cancel();

    private void Save()
    {
        if (string.IsNullOrWhiteSpace(NewItem.Name))
        {
            return;
        }
        if (NewItem.CategoryId == 0)
        {
            return;
        }

        MudDialog.Close(DialogResult.Ok(NewItem));
    }
}
