@page "/LateEmployeesReport"


@if (data == null)
{
    <p>Loading...</p>
}
else if (!data.Any())
{
    <p>✅ All employees are on time today!</p>
}
else
{
    <div class="container mt-4">
        <h2 class="text-center mb-4">Daily Attendance Summary</h2>

        @foreach (var deptGroup in data
            .Where(x => x.ArrivalStatus != "On Time" || x.LeavingStatus != "On Time")
            .GroupBy(x => x.Department))
        {
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-primary text-white fs-5 fw-bold">
                    <i class="fa-solid fa-building me-2"></i>@deptGroup.Key
                </div>
                <div class="card-body p-0">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                            <tr class="fw-semibold text-secondary">
                                <th style="width: 80px;">Emp #</th>
                                <th>Name</th>
                                <th class="text-center">In Late</th>
                                <th class="text-center">Out Early</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in deptGroup)
                            {
                                <tr>
                                    <td>@item.EmpId</td>
                                    <td>@item.Fullname</td>
                                    <td class="text-center text-danger">
                                        @if (item.ArrivalStatus != "On Time")
                                        {
                                            <span>@item.InDiff</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">–</span>
                                        }
                                    </td>
                                    <td class="text-center text-warning">
                                        @if (item.LeavingStatus != "On Time")
                                        {
                                            <span>@item.OutDiff</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">–</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
    </div>

}


@code {
    List<DailyAttendanceModel> data = new();
    private bool LoadingPanel { get; set; } = false;

    protected override async Task OnInitializedAsync()
    {
        await GetAll();
    }

    protected async Task GetAll()
    {
        LoadingPanel = true;
        data = await Functions.GetAsync<List<DailyAttendanceModel>>($"DailyAttendance/Search/InDate='2025-10-22' and ArrivalStatus!='ON TIME' and LeavingStatus!='ON TIME'", true) ?? new List<DailyAttendanceModel>();
        LoadingPanel = false;
    }

    // private string GetRowClass(DailyAttendanceModel item)
    // {
    //     if (item.ArrivalStatus == "LATE")
    //         return "table-warning";
    //     if (item.LeavingStatus == "BEFORE TIME")
    //         return "table-info";
    //     if (item.ArrivalStatus == "INCOMPLETE" || item.LeavingStatus == "INCOMPLETE")
    //         return "table-danger";
    //     return "";
    // }
}

<style>
    .card {
        border-radius: 12px;
        overflow: hidden;
    }

    .card-header {
        background: linear-gradient(90deg, #007bff, #0056b3);
        letter-spacing: 0.5px;
    }

    .table th {
        background-color: #f8f9fa;
    }

    .table tr:hover {
        background-color: #f1f5ff;
    }

    .text-danger {
        font-weight: 600;
    }

    .text-warning {
        font-weight: 600;
    }

    .container {
        max-width: 1000px;
    }
</style>